<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="webfrogs" />
    <title>xcode自动打ipa包脚本 | webfrogs</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="/feed/" rel="alternate" title="webfrogs" type="application/atom+xml" />
    <link rel="stylesheet" href="/media/css/style.css">
    <link rel="stylesheet" href="/media/css/highlight.css">
    <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
  </head>
  <script type="text/javascript">
    function setTimeSpan(){
    	var date = new Date();
    	timeSpan.innerText=date.format('yyyy-MM-dd hh:mm:ss');
    }
    
    Date.prototype.format = function(format)
		{
    var o =
    	{
    	    "M+" : this.getMonth()+1, //month
    	    "d+" : this.getDate(),    //day
    	    "h+" : this.getHours(),   //hour
    	    "m+" : this.getMinutes(), //minute
    	    "s+" : this.getSeconds(), //second
    	    "q+" : Math.floor((this.getMonth()+3)/3),  //quarter
    	    "S" : this.getMilliseconds() //millisecond
    	}
    	if(/(y+)/.test(format))
    	format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4 - RegExp.$1.length));
    	for(var k in o)
    	if(new RegExp("("+ k +")").test(format))
    	format = format.replace(RegExp.$1,RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
    	return format;
		}
  </script>
  <body onLoad="setInterval(setTimeSpan,1000);">
    <div id="container">
      <div id="main" role="main">
        <header>
        <h1>xcode自动打ipa包脚本</h1>
        </header>
        <nav>
        <span><a title="home page" class="" href="/">Home</a></span>
        <span><a title="about" class="" href="/about/">About</a></span>
        <span><a title="guestbook" class="" href="/guestbook/">Guestbook</a></span>
        <span><a title="categories" class="" href="/categories/">Categories</a></span>
        <span><a title="tags" class="" href="/tags/">Tags</a></span>
        <span><a title="links" class="" href="/links/">Links</a></span>
        <span><a title="subscribe by RSS" class="" href="/feed/">Subscribe</a></span>
        </nav>
        <article class="content">
        <section class="post">
<h1>前言</h1>

<hr />

<p>使用xcode进行IOS开发的时候，很多时候我们需要将工程打包成ipa文件，而xcode本身并没有这些功能。但是通过安装xcode的“Command Line Tools”这个工具，我们可以使用xcodebuild这个命令来对工程进行打包。然而这么打包出来的文件是以".app"后缀的。其实将其做成ipa文件也非常的简单，只要新建一个名为“Payload”的文件夹，将这个app文件放到里面，并将Payload文件夹压缩，将其后缀名改为ipa即可。借助shell脚本，我们可以让其自动完成这一过程。</p>

<h1>编写</h1>

<hr />

<p>下面是shell脚本内容：</p>

<pre><code>#!/bin/bash

#--------------------------------------------
# 功能：为xcode工程打ipa包
# 作者：ccf
# E-mail:ccf.developer@gmail.com
# 创建日期：2012/09/24
#--------------------------------------------


#参数判断
if [ $# != 2 ] &amp;&amp; [ $# != 1 ];then
    echo "Number of params error! Need one or two params!"
    echo "1.path of project(necessary) 2.name of ipa file(optional)"
    exit    
elif [ ! -d $1 ];then
    echo "Params Error!! The first param must be a dictionary."
    exit    
fi

#工程绝对路径
cd $1
project_path=$(pwd)
#build文件夹路径
build_path=${project_path}/build

#工程配置文件路径
project_name=$(ls | grep xcodeproj | awk -F.xcodeproj '{print $1}')
project_infoplist_path=${project_path}/${project_name}/${project_name}-Info.plist
#取版本号
bundleShortVersion=$(/usr/libexec/PlistBuddy -c "print CFBundleShortVersionString" ${project_infoplist_path})
#取build值
bundleVersion=$(/usr/libexec/PlistBuddy -c "print CFBundleVersion" ${project_infoplist_path})
#取bundle Identifier前缀
#bundlePrefix=$(/usr/libexec/PlistBuddy -c "print CFBundleIdentifier" `find . -name "*-Info.plist"` | awk -F$ '{print $1}')


#IPA名称
if [ $# = 2 ];then
ipa_name=$2
fi


#编译工程
cd $project_path
xcodebuild || exit

#打包
cd $build_path
target_name=$(basename ./Release-iphoneos/*.app | awk -F. '{print $1}')
if [ $# = 1 ];then
ipa_name="${target_name}_${bundleShortVersion}_build${bundleVersion}_$(date +"%Y%m%d")"
fi

if [ -d ./ipa-build ];then
    rm -rf ipa-build
fi
mkdir -p ipa-build/Payload
cp -r ./Release-iphoneos/*.app ./ipa-build/Payload/
cd ipa-build
zip -r ${ipa_name}.ipa *
rm -rf Payload
</code></pre>

<p>将shell脚本保存，命名为“ipa-build”，然后为其添加可执行权限，命令如下：</p>

<pre><code>chmod +x ipa-build
</code></pre>

<p>这里提供shell脚本下载，下载完后，只需要为其增加可执行权限即可。<a href="/assets/download/ipa-build">下载点这里</a></p>

<h1>使用</h1>

<hr />

<p>使用非常简单，ipa-build执行需要两个参数，第一个参数是IOS工程所在的根目录(必须)，第二个参数就是生成ipa文件的文件名（不需要带后缀名ipa），第二个参数是可选的，如果不输入，则ipa文件生成默认格式：<em>(targetname)_(version)_build(buildversion)_yyyyMMdd.ipa</em> 括号里分别代表所对应的值，yyyyMMdd是当前日期格式。如果未将ipa-build加入环境变量中，使用时需要使用绝对路径。例如：需要打包的工程根路径为：~/iphone/HuaRongDao，而ipa-build放在了 ~/shell 路径下，要生成名为“HuaRongDao.ipa”的文件，则使用如下命令：</p>

<pre><code>~/shell/ipa-build ~/iphone/HuaRongDao HuaRongDao
</code></pre>

<p>命令执行完成后，会在工程目录下生成一个名为“build”的文件夹，打包好的ipa就放在build文件夹下的“ipa-build”文件夹中。</p>

<h1>总结</h1>

<hr />

<p>写这么一个脚本，主要是受到了一篇文章的启发，是一篇为IOS增加DailyBuild的文章，敏捷开发目前还没有接触，不过那篇文章的博客很不错。文章地址：<a href="http://blog.devtang.com/blog/2012/02/16/apply-daily-build-in-ios-project/">《给iOS工程增加Daily Build》</a>。 文章中还有一个很有意思的地方，就是通过itms-services协议来安装ipa，已经尝试了，很有用，可以方便测试人员测试，并且可以给越狱手机做自动更新软件功能。待整理后，会写一篇文章来总结。</p>

<p>通过使用shell脚本，确实可以减少很多的工作量。脚本目前还有很多可以完善的地方，同时在做这个脚本的时候，也发现自己的linux知识上的不足，看来要多充充电了。</p>

</section>
<section class="meta">

<br/>
<br/>
<span>
	<a  href="http://webfrogs.github.com/2012/09/18/appledoc/" class="pageNav"  >Previous</a>
	&nbsp;&nbsp;&nbsp;
	<a  href="http://webfrogs.github.com/2012/09/27/ipapublsh/" class="pageNav"  >Next</a>
</span>
<hr>
<span class="author">
  <a href="http://webfrogs.github.com">webfrogs</a>
</span>
<span class="time">
  /
  <time datetime="2012-09-19">2012-09-19</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="/categories/#ios" title="ios">ios</a>&nbsp;
  
</span>


<span class="tags">
  tagged with 
  
  <a href="/tags/#iOS" title="iOS">iOS</a>&nbsp;
  
  <a href="/tags/#xcode" title="xcode">xcode</a>&nbsp;
  
</span>

</section>
<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"webfrogs"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
<!--
<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://webfrogs.github.com/2012/09/18/appledoc/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://webfrogs.github.com/2012/09/27/ipapublsh/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>
-->


        </article>
      </div>

    <footer>
        <p><small>Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> & <a href="http://pages.github.com">GitHub</a> | Copyright 2012 - 2013 by <a href="/about/">webfrogs</a> | <span class="label label-info" id="timeSpan"></span></small></p>
    </footer>

    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-34960818-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

    <!-- Baidu Button BEGIN -->
		<script type="text/javascript" id="bdshare_js" data="type=slide&amp;img=4&amp;pos=right&amp;uid=541841" ></script>
		<script type="text/javascript" id="bdshell_js"></script>
		<script type="text/javascript">
		var bds_config={"bdTop":170};
		document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000);
		</script>
		<!-- Baidu Button END -->
  </body>
</html>
